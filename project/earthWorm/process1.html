<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>문유라 1코스 15강 예제</title>
  <style>
        *{margin:0;padding:0;}
        body{height:100vh;display:flex;display:-webkit-flex;justify-content:center;align-items:center;}
        .banner{display:flex;display:-webkit-flex;justify-content:space-between;}
        .score{display:inline-block;padding:3px 10px;background-color:rgb(57, 57, 141);color:#fff;font-weight:bold;border-radius:5px;}
        .board{position:relative;width:604px;height:604px;border:2px dashed rgb(48, 54, 160);margin-top:15px;}
        .game_over{position:absolute;width:100%;height:100%;background-color:rgba(255,255,255,0.7);text-align:center;line-height:600px;font-size:50px;font-weight:bold;}
        .replay{appearance:none;border:0;background-color:rgb(96, 110, 156);padding:3px 10px;border-radius:5px;color:#fff;font-weight:bold;cursor:pointer;}
        .worm_head{background:blue;}
        .worm_body{background:#000;}
        table{width:600px;height:600px;position:absolute;left:2px;top:2px;border-collapse:collapse;}
        table td{width:20px;height:20px;}
        table td>span{display:block;width:100%;height:100%;}
  </style>
</head>
<body>

    <div class="wrap">
        <div class="banner">
            <span class="score">Score : <span class="get_score">0</span></span>
            <button class="replay">Replay</button>
        </div>
        <div class="board">
            <table>
                <tbody></tbody>
            </table>
            <div class="game_over" style="opacity:0;">Game Over</div>
        </div>
    </div>

  <script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
  <script>
    class Game {
        constructor() {
            // 초기화
            this.stages = 
                {
                    map:[
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,2,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
                    ]
                };
            // 게임판그리기
            this.drawStage(this.stages);
            // head가 feed와 겹치면 feed의 수만큼 지렁이몸통이 늘어나고 먹힌 feed는 없어지면서 다른 곳에 랜덤으로 1개 생성된다.


            // replay를 클릭하면 게임을 초기화한다.
            let replay=document.querySelector('.replay');
            replay.addEventListener('click',function(){
                this.drawStage(this.stages);
            });
        };
        // 게임판을 그리는 함수
        drawStage(stage){
          let html = '';
          let feedNum;
          let tbody = document.querySelector('tbody');
          html += `<tr>`;
          for(let y=0; y<stage.map.length; y+=1) {
            for(let x=0; x<stage.map[y].length; x+=1) {
                feedNum=Math.floor((Math.random()*10)+1);
                if( stage.map[y][x] === 0 ) html += `<td class='space cell_${x}_${y}' data-x='${x}' data-y='${y}'></td>`;
                if( stage.map[y][x] === 1 ) html += `<td class='space worm_head cell_${x}_${y}' data-x='${x}' data-y='${y}'></td>`;
                if( stage.map[y][x] === 2 ) html += `<td class='space worm_body cell_${x}_${y}' data-x='${x}' data-y='${y}'></td>`;
                if( stage.map[y][x] === 4 ) html += `<td class='space feed cell_${x}_${y}' data-x='${x}' data-y='${y}'>${feedNum}</td>`;
            }
            html += `</tr>`;
          }
          tbody.innerHTML=html;
        }
        movingRight(){
            let wormBody = document.querySelectorAll('.worm_body');
            let tr = document.querySelector('tr');
            let td = tr.querySelectorAll('td');
            let head = document.querySelector('td.worm_head');
            let playerX = parseInt(head.getAttribute("data-x"));
            let playerY = parseInt(head.getAttribute("data-y"));
            moveR=false;
            for(let x=0;x<wormBody.length;x+=1){
                // y값이 같을 때 움직임
                if(head.getAttribute('data-y')===wormBody[x].getAttribute('data-y')){
                    if(playerX+1===td.length){
                        $(`td.cell_${playerX-playerX}_${playerY}`).addClass('worm_head');
                        $(`td.cell_${playerX}_${playerY}`).removeClass('worm_head').addClass('worm_body');
                        $(`td.cell_${(td.length-1)-(wormBody.length)}_${playerY}`).removeClass('worm_body');
                    }
                    else if(playerX+1<wormBody.length){
                        $(`td.cell_${playerX+1}_${playerY}`).addClass('worm_head');
                        $(`td.cell_${playerX}_${playerY}`).removeClass('worm_head').addClass('worm_body');
                        $(`td.cell_${(td.length)-(wormBody.length-(playerX))}_${playerY}`).removeClass('worm_body');
                    }
                    else if(playerX+1===wormBody.length){
                        $(`td.cell_${playerX+1}_${playerY}`).addClass('worm_head');
                        $(`td.cell_${playerX}_${playerY}`).removeClass('worm_head').addClass('worm_body');
                        $(`td.cell_${td.length-1}_${playerY}`).removeClass('worm_body');
                    }else{
                        $(`td.cell_${playerX+1}_${playerY}`).addClass('worm_head');
                        $(`td.cell_${playerX}_${playerY}`).removeClass('worm_head').addClass('worm_body');
                        $(`td.cell_${playerX-wormBody.length}_${playerY}`).removeClass('worm_body');
                    }
                }else if(head.getAttribute('data-y')>wormBody[x].getAttribute('data-y')){

                }
            }
        }
        movingLeft(){
                let wormBody=document.querySelectorAll('.worm_body');
                let tr = document.querySelector('tr');
                let td = tr.querySelectorAll('td');
                let head = document.querySelector('td.worm_head');
                let playerX = parseInt(head.getAttribute("data-x"));
                let playerY = parseInt(head.getAttribute("data-y"));
                moveL=false;
                for(let x=0;x<wormBody.length;x+=1){
                    // y값이 같을 때 움직임playerX-playerX
                    if(head.getAttribute('data-y')===wormBody[x].getAttribute('data-y')){
                        if(playerX-1===-1){
                            $(`td.cell_${td.length-1}_${playerY}`).addClass('worm_head');
                            $(`td.cell_${playerX}_${playerY}`).removeClass('worm_head').addClass('worm_body');
                            $(`td.cell_${playerX+wormBody.length}_${playerY}`).removeClass('worm_body');

                        }
                        else if(wormBody.length>td.length-playerX){
                            $(`td.cell_${playerX-1}_${playerY}`).addClass('worm_head');
                            $(`td.cell_${playerX}_${playerY}`).removeClass('worm_head').addClass('worm_body');
                            $(`td.cell_${((wormBody.length+1)-(td.length-playerX))-1}_${playerY}`).removeClass('worm_body');
                        }
                        else if(td.length-playerX===wormBody.length){
                            $(`td.cell_${playerX-1}_${playerY}`).addClass('worm_head');
                            $(`td.cell_${playerX}_${playerY}`).removeClass('worm_head').addClass('worm_body');
                            $(`td.cell_${0}_${playerY}`).removeClass('worm_body');
                        }
                        else{
                            $(`td.cell_${playerX-1}_${playerY}`).addClass('worm_head');
                            $(`td.cell_${playerX}_${playerY}`).removeClass('worm_head').addClass('worm_body');
                            $(`td.cell_${playerX+wormBody.length}_${playerY}`).removeClass('worm_body');
                        }
                    }
                    // else if(head.getAttribute('data-y')>wormBody[x].getAttribute('data-y')){

                    // }
                }
        }
        movingBottom(){
            let wormBody = document.querySelectorAll('.worm_body');
            let tr = document.querySelectorAll('tr');
            let head = document.querySelector('td.worm_head');
            let playerX = parseInt(head.getAttribute("data-x"));
            let playerY = parseInt(head.getAttribute("data-y"));
            moveB=false;
            for(let x=0;x<wormBody.length;x+=1){
            if(head.getAttribute('data-x')===wormBody[x].getAttribute('data-x')){
                    if(playerY+1===tr.length){
                        $(`td.cell_${playerX}_${playerY-playerY}`).addClass('worm_head');
                        $(`td.cell_${playerX}_${tr.length-1}`).removeClass('worm_head').addClass('worm_body');
                        $(`td.cell_${playerX}_${(tr.length)-(wormBody.length+1)}`).removeClass('worm_body');
                    }
                    else if(playerY+1<wormBody.length){
                        $(`td.cell_${playerX}_${playerY+1}`).addClass('worm_head');
                        $(`td.cell_${playerX}_${playerY}`).removeClass('worm_head').addClass('worm_body');
                        $(`td.cell_${playerX}_${(tr.length)-(wormBody.length-(playerY))}`).removeClass('worm_body');
                    }
                    else if(playerY+1===wormBody.length){
                        $(`td.cell_${playerX}_${playerY+1}`).addClass('worm_head');
                        $(`td.cell_${playerX}_${playerY}`).removeClass('worm_head').addClass('worm_body');
                        $(`td.cell_${playerX}_${tr.length-1}`).removeClass('worm_body');
                    }else{
                        $(`td.cell_${playerX}_${playerY+1}`).addClass('worm_head');
                        $(`td.cell_${playerX}_${playerY}`).removeClass('worm_head').addClass('worm_body');
                        $(`td.cell_${playerX}_${playerY-wormBody.length}`).removeClass('worm_body');
                    }
                }
            }
        }
        movingTop(){
            let wormBody=document.querySelectorAll('.worm_body');
            let tr = document.querySelectorAll('tr');
            let head = document.querySelector('td.worm_head');
            let playerX = parseInt(head.getAttribute("data-x"));
            let playerY = parseInt(head.getAttribute("data-y"));
            moveT=false;

            for(let x=0;x<wormBody.length;x+=1){
                if(head.getAttribute('data-x')===wormBody[x].getAttribute('data-x')){
                    if(playerY-1===-1){
                        $(`td.cell_${playerX}_${tr.length-1}`).addClass('worm_head');
                        $(`td.cell_${playerX}_${playerY}`).removeClass('worm_head').addClass('worm_body');
                        $(`td.cell_${playerX}_${playerY+wormBody.length}`).removeClass('worm_body');
                    }
                    else if(wormBody.length>tr.length-playerY){
                        $(`td.cell_${playerX}_${playerY-1}`).addClass('worm_head');
                        $(`td.cell_${playerX}_${playerY}`).removeClass('worm_head').addClass('worm_body');
                        $(`td.cell_${playerX}_${((wormBody.length+1)-(tr.length-playerY))-1}`).removeClass('worm_body');
                        // clearInterval(move)
                    }
                    else if(tr.length-playerY===wormBody.length){
                        $(`td.cell_${playerX}_${playerY-1}`).addClass('worm_head');
                        $(`td.cell_${playerX}_${playerY}`).removeClass('worm_head').addClass('worm_body');
                        $(`td.cell_${playerX}_${0}`).removeClass('worm_body');
                    }
                    else{
                        $(`td.cell_${playerX}_${playerY-1}`).addClass('worm_head');
                        $(`td.cell_${playerX}_${playerY}`).removeClass('worm_head').addClass('worm_body');
                        $(`td.cell_${playerX}_${playerY+wormBody.length}`).removeClass('worm_body');
                    }
                // }
                // else if(head.getAttribute('data-y')>wormBody[x].getAttribute('data-y')){

                }
            }
        }    
    }
    let draw=new Game();
    let move;
     move=setInterval(draw.movingLeft,300);
    let moveR=true, moveB=true, moveL=true, moveT=true;
    window.addEventListener('keydown', (ev) => {
        if( ev.keyCode===37 ) {
            moveT=true;
            moveB=true;
            if(!moveR){
            }else{
                clearInterval(move);
                move=setInterval(draw.movingLeft,300);
            }
        }
        if( ev.keyCode===38 ) {
            moveL=true;
            moveR=true;
            if(!moveB){
            }else{
                clearInterval(move);
                move=setInterval(draw.movingTop,300);
            }
        }
        if( ev.keyCode===39 ) {
            moveT=true;
            moveB=true;
            if(!moveL){
            }else{
                clearInterval(move);
                move=setInterval(draw.movingRight,300);
            }
        }
        if( ev.keyCode===40 ) {
            moveL=true;
            moveR=true;
            if(!moveT){
            }else{
                clearInterval(move);
                move=setInterval(draw.movingBottom,300);
            }
        }

    });


  </script>
</body>
</html>